{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-ticket-alt text-primary"></i> Helpdesk Tickets</h2>
    <div>
        <a href="{% url 'category_list' %}" class="btn btn-outline-secondary me-2"><i class="fas fa-tags"></i> Categories</a>
        <a href="{% url 'ticket_archive' %}" class="btn btn-outline-dark me-2"><i class="fas fa-archive"></i> Archive</a>
        <a href="{% url 'ticket_create' %}" class="btn btn-primary"><i class="fas fa-plus"></i> New Ticket</a>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="alert alert-primary d-flex justify-content-between align-items-center mb-0">
            <span><strong>{{ open_count }}</strong> Open</span>
            <i class="fas fa-envelope-open"></i>
        </div>
    </div>
    <div class="col-md-4">
        <div class="alert alert-success d-flex justify-content-between align-items-center mb-0">
            <span><strong>{{ resolved_count }}</strong> Resolved</span>
            <i class="fas fa-check-circle"></i>
        </div>
    </div>
    <div class="col-md-4">
        <div class="alert alert-secondary d-flex justify-content-between align-items-center mb-0">
            <span><strong>{{ closed_count }}</strong> Archived</span>
            <i class="fas fa-archive"></i>
        </div>
    </div>
</div>

<div class="card card-custom p-0 overflow-hidden">
    <table class="table table-striped mb-0">
        <thead class="bg-light">
            <tr>
                <th class="p-3">ID</th>
                <th class="p-3">Subject</th>
                <th class="p-3">Category</th>
                <th class="p-3">Priority</th>
                <th class="p-3">Status</th>
                <th class="p-3">Assigned To</th>
                <th class="p-3">Created</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in tickets %}
            <tr>
                <td class="p-3">#{{ ticket.id }}</td>
                <td class="p-3">
                    <a href="{% url 'ticket_detail' ticket.id %}" class="fw-bold text-decoration-none text-dark">
                        {{ ticket.title }}
                    </a>
                </td>
                <td class="p-3"><span class="badge bg-light text-dark border">{{ ticket.category.name|default:"General" }}</span></td>
                <td class="p-3">
                    {% if ticket.priority == 'HIGH' or ticket.priority == 'CRITICAL' %}
                        <span class="badge bg-danger">{{ ticket.priority }}</span>
                    {% elif ticket.priority == 'MEDIUM' %}
                        <span class="badge bg-warning text-dark">{{ ticket.priority }}</span>
                    {% else %}
                        <span class="badge bg-info text-dark">{{ ticket.priority }}</span>
                    {% endif %}
                </td>
                <td class="p-3">
                    {% if ticket.status == 'OPEN' %} <span class="badge rounded-pill bg-primary">Open</span>
                    {% elif ticket.status == 'RESOLVED' %} <span class="badge rounded-pill bg-success">Resolved</span>
                    {% else %} <span class="badge rounded-pill bg-secondary">{{ ticket.status }}</span>
                    {% endif %}
                </td>
                <td class="p-3">{{ ticket.assigned_to.username|default:"-" }}</td>
                <td class="p-3 text-muted small">{{ ticket.created_at|date:"M d" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="7" class="text-center p-5 text-muted">No active tickets. Check the archive?</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}